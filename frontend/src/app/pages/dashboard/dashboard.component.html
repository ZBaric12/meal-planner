<div class="page">
  <div class="card">
    <div class="header-row">
      <h1>Tvoj tjedni plan</h1>
      <button class="btn ghost danger" (click)="logout()">Odjava</button>
    </div>

    <!-- Filtri -->
    <div class="filters">
      <div class="field">
        <label>Od</label>
        <input
          class="input"
          type="date"
          [(ngModel)]="weekStart"
          (change)="refresh()"
          aria-label="Datum od"
        />
      </div>

      <div class="field">
        <label>Do</label>
        <input
          class="input"
          type="date"
          [(ngModel)]="weekEnd"
          (change)="refresh()"
          aria-label="Datum do"
        />
      </div>

      <button class="btn" (click)="refresh()" [disabled]="loading">
        Osvježi
      </button>
    </div>

    <!-- Tablica -->
    <table class="table">
      <thead>
        <tr>
          <th>Datum</th>
          <th>Naziv</th>
          <th>kcal</th>
          <th class="right">Akcije</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let m of items">
          <td>{{ m.date | date:'yyyy-MM-dd' }}</td>
          <td>{{ m.title }}</td>
          <td>{{ m.calories }}</td>
          <td class="actions">
            <button class="btn ghost" (click)="edit(m)">Uredi</button>
            <button class="btn ghost danger" (click)="remove(m)">Obriši</button>
          </td>
        </tr>

        <tr *ngIf="!items.length">
          <td colspan="4" class="empty">Nema zapisa u ovom rasponu.</td>
        </tr>
      </tbody>
    </table>

    <!-- Forma -->
    <h2>Dodaj obrok</h2>

    <!-- anchor za glatko skrolanje kad klikneš "Uredi" -->
    <div class="form-anchor"></div>

    <div class="form-grid">
      <div class="field">
        <label>Datum</label>
        <input
          class="input"
          type="date"
          [(ngModel)]="form.date"
          name="date"
          required
        />
      </div>

      <div class="field">
        <label>Naziv</label>
        <input
          class="input"
          type="text"
          [(ngModel)]="form.title"
          name="title"
          required
          placeholder="npr. Muffini s mrkvom"
        />
      </div>

      <div class="field">
        <label>kcal</label>
        <input
          class="input"
          type="number"
          [(ngModel)]="form.calories"
          name="calories"
          required
          min="0"
        />
      </div>

      <div class="actions-row">
        <button class="btn" (click)="save()" [disabled]="loading">
          {{ form.id ? 'Spremi' : 'Dodaj' }}
        </button>
        <button class="btn ghost" *ngIf="form.id" (click)="cancelEdit()">
          Odustani
        </button>
      </div>
    </div>

    <!-- Poruke -->
    <div class="alert ok" *ngIf="ok as msg">{{ msg }}</div>
    <div class="alert error" *ngIf="error as msg">{{ msg }}</div>
  </div>
</div>
